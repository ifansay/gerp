generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["tracing", "views", "relationJoins", "metrics"]
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  directUrl         = env("DIRECT_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

generator erd {
  provider     = "prisma-erd-generator"
  ignoreTables = ["_prisma_migrations", "Session", "Account", "Example"]
  disabled     = true
  ignoreEnums  = true
  output       = "database.svg"
}

generator kysely {
  provider = "prisma-kysely"

  // Optionally provide a destination directory for the generated file
  // and a filename of your choice
  // output = "../src/db"
  // fileName = "types.ts"
  // Optionally generate runtime enums to a separate file
  // enumFileName = "enums.ts"
}

// Necessary for Next auth
model Account {
  id                       String  @id @default(cuid())
  userId                   String  @map("user_id")
  type                     String
  provider                 String
  providerAccountId        String
  refresh_token            String? // @db.Text
  access_token             String? // @db.Text
  expires_at               Int?
  expires_in               Int?
  ext_expires_in           Int?
  token_type               String?
  scope                    String?
  id_token                 String? // @db.Text
  session_state            String?
  refresh_token_expires_in Int?
  created_at               Int? // GitLab
  user                     User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}


model User {
  id                      String                   @id @default(cuid())
  name                    String?
  email                   String?                  @unique
  emailVerified           DateTime?                @map("email_verified")
  password                String?
  image                   String?
  admin                   Boolean                  @default(false)
  accounts                Account[]
  sessions                Session[]
  organizationMemberships OrganizationMembership[]
  projectMemberships      ProjectMembership[]
  invitations             MembershipInvitation[]
  createdAt               DateTime                 @default(now()) @map("created_at")
  updatedAt               DateTime                 @default(now()) @updatedAt @map("updated_at")
  featureFlags            String[]                 @default([]) @map("feature_flags")
  annotatedLockedItem     AnnotationQueueItem[]    @relation("LockedByUser")
  annotatedCompletedItem  AnnotationQueueItem[]    @relation("AnnotatorUser")

  @@map("users")
}
